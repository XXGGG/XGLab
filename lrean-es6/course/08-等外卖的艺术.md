# 08-ç­‰å¤–å–çš„è‰ºæœ¯.md

ğŸ• æ¬¢è¿æ¥åˆ°ç¬¬å…«è¯¾ï¼

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ç‚¹äº†ä¸ªå¤–å–ã€‚
ä½ ä¸ä¼šç«™åœ¨é—¨å£ä¸€ç›´ç›¯ç€å¤–å–å‘˜ä»åº—é‡Œé€åˆ°ä½ å®¶ï¼ˆè¿™å«**åŒæ­¥**ï¼Œä½ ä¼šé¥¿æ­»ï¼‰ã€‚
ä½ ä¼šå…ˆå»æ‰“æŠŠæ¸¸æˆï¼Œç­‰é—¨é“ƒå“äº†å†å»æ‹¿ï¼ˆè¿™å«**å¼‚æ­¥**ï¼‰ã€‚

åœ¨ JS é‡Œï¼Œç½‘ç»œè¯·æ±‚ï¼ˆæ¯”å¦‚ä»æœåŠ¡å™¨æ‹¿æ•°æ®ï¼‰å°±æ˜¯ç‚¹å¤–å–ã€‚ä»¥å‰æˆ‘ä»¬ç”¨å›è°ƒå‡½æ•°ï¼ˆCallback Hellï¼‰ï¼Œåæ¥ç”¨ Promiseï¼Œç°åœ¨æˆ‘ä»¬æœ‰ç»ˆææ­¦å™¨ï¼š**Async / Await**ã€‚

## ğŸ£ åŸºç¡€ç”¨æ³•

### 1. `async`ï¼šå£°æ˜â€œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°â€

åªè¦åœ¨å‡½æ•°å‰é¢åŠ ä¸Š `async`ï¼Œè¿™ä¸ªå‡½æ•°å°±å˜å¾—â€œä¸ä¸€èˆ¬â€äº†ã€‚

```javascript
async function getData() {
  return "æ•°æ®æ¥äº†";
}
```

### 2. `await`ï¼šåç­‰ç»“æœ

`await` åªèƒ½åœ¨ `async` å‡½æ•°é‡Œé¢ç”¨ã€‚å®ƒçš„æ„æ€æ˜¯ï¼šâ€œ**åœï¼ç­‰è¿™ä¸ªå¼‚æ­¥æ“ä½œåšå®Œäº†ï¼Œå†å¾€ä¸‹æ‰§è¡Œã€‚**â€

```javascript
async function fetchUser() {
  console.log("å¼€å§‹ç‚¹å¤–å–...");
  
  // å‡è®¾ fetch æ˜¯å»åå°æ‹¿æ•°æ®ï¼Œéœ€è¦æ—¶é—´
  // await ä¼šæš‚åœåœ¨è¿™é‡Œï¼Œç›´åˆ°æ•°æ®æ‹¿å›æ¥
  const response = await fetch('https://api.example.com/user');
  const data = await response.json();

  console.log("å¤–å–åˆ°äº†ï¼š", data);
}
```

### 3. `try...catch`ï¼šå¤–å–ä¸¢äº†å’‹åŠï¼Ÿ

å¦‚æœè¯·æ±‚å¤±è´¥äº†ï¼ˆæ–­ç½‘ã€æœåŠ¡å™¨ç‚¸äº†ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æ•è·é”™è¯¯ã€‚

```javascript
async function safeFetch() {
  try {
    const res = await fetch('/api/user');
    // ...å¤„ç†æ•°æ®
  } catch (error) {
    console.log("å“å‘€ï¼Œå¤–å–ä¸¢äº†ï¼", error);
  }
}
```

## ğŸ­ åœºæ™¯å®æˆ˜

### Vue (Nuxt) ä¸­çš„ç”¨æ³•

Nuxt å°è£…äº† `useFetch`ï¼Œç”¨èµ·æ¥åƒåŒæ­¥ä¸€æ ·ç®€å•ï¼Œä½†åº•å±‚è¿˜æ˜¯å¼‚æ­¥ã€‚

```javascript
<script setup>
// åœ¨ Nuxt ä¸­ï¼Œawait ä¼šé˜»å¡é¡µé¢æ¸²æŸ“ï¼Œç›´åˆ°æ•°æ®å›æ¥ï¼ˆSSRï¼‰
const { data: user } = await useFetch('/api/me');
</script>
```

å¦‚æœåœ¨æ™®é€šçš„ Vue æ–¹æ³•é‡Œï¼š
```javascript
const login = async () => {
  isLoading.value = true;
  try {
    await authService.login(username, password);
    router.push('/home');
  } catch (e) {
    alert('ç™»å½•å¤±è´¥');
  } finally {
    isLoading.value = false;
  }
};
```

### React (Next) ä¸­çš„ç”¨æ³•

åœ¨ Next.js çš„æœåŠ¡ç«¯ç»„ä»¶ (Server Components) é‡Œï¼Œä½ å¯ä»¥ç›´æ¥å†™ async ç»„ä»¶ï¼

```javascript
// app/page.js
export default async function Page() {
  // ç›´æ¥åœ¨ç»„ä»¶é‡Œ awaitï¼å¤ªçˆ½äº†ï¼
  const data = await getDataFromDB();

  return <main>{data.title}</main>;
}
```

åœ¨å®¢æˆ·ç«¯ç»„ä»¶ (Client Components) é‡Œï¼Œé€šå¸¸åœ¨ `useEffect` æˆ–äº‹ä»¶å¤„ç†ä¸­ä½¿ç”¨ï¼š

```javascript
const handleClick = async () => {
  const res = await fetch('/api/submit');
  // ...
};
```

## ğŸ§  æ€»ç»“

- çœ‹åˆ° `Promise` æˆ–è€…ç½‘ç»œè¯·æ±‚ï¼Œå°±æƒ³åˆ° `async/await`ã€‚
- `await` è®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼Œä¸€è¡Œä¸€è¡Œè¯»ï¼Œéå¸¸èˆ’æœã€‚
- è®°å¾—ç”¨ `try...catch` å¤„ç†å¯èƒ½çš„é”™è¯¯ï¼Œä¸è¦è®©ç¨‹åºå´©å¾—è«åå…¶å¦™ã€‚

## âœï¸ è¯¾åä½œä¸š

1.  æŠŠä¸‹é¢çš„ Promise å†™æ³•æ”¹æˆ async/await å†™æ³•ï¼š
    ```javascript
    function getInfo() {
      fetch('/api/info')
        .then(res => res.json())
        .then(data => console.log(data))
        .catch(err => console.error(err));
    }
    ```

---
**ä¸‹ä¸€è¯¾é¢„å‘Š**ï¼šå¦‚æœä½ çš„å¯¹è±¡å±‚çº§å¾ˆæ·±ï¼Œå–å€¼çš„æ—¶å€™æ€»æ˜¯æŠ¥é”™ `undefined` æ€ä¹ˆåŠï¼Ÿæ•™ä½ æœ€å®‰å…¨çš„å–å€¼å§¿åŠ¿ï¼ğŸ›¡ï¸


## ğŸŸ¢ XXGä½œä¸šï¼š

```javascript
await function getInfo(){
  try{
    const res = await fetch('/api/info')
    console.log(res.json())
  } catch (err){
    console.log(err)
  }
}
```